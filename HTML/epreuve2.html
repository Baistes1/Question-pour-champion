<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Questions pour un Champion - 4 Ã  la suite</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }

    body{
      background:#000;
      color:#fff;
      width:100vw;
      height:100vh;
      overflow:hidden;
      position:relative;
    }

    /* Ã‰TOILES */
    .stars{ position:fixed; inset:0; z-index:-1; pointer-events:none; overflow:hidden; }
    .star{
      position:absolute;
      background:#fff;
      border-radius:50%;
      opacity:.75;
      animation:twinkle 3s infinite;
    }
    @keyframes twinkle{
      0%,100%{ opacity:.25; transform:scale(1); }
      50%{ opacity:1; transform:scale(1.25); }
    }

    /* HUD PROFIL */
    .hud{
      position:absolute;
      top:16px; left:16px;
      display:flex;
      gap:12px;
      align-items:center;
      padding:10px 12px;
      border-radius:14px;
      background:rgba(0, 26, 77, 0.65);
      border:2px solid rgba(255,255,255,.18);
      backdrop-filter: blur(6px);
    }
    .hud img{
      width:52px; height:52px;
      border-radius:12px;
      object-fit:cover;
      border:2px solid rgba(248,213,75,.55);
      background:rgba(0,0,0,.25);
    }
    .hud .name{ font-weight:800; font-size:18px; color:#F8D54B; line-height:1.1; }
    .hud .sub{ font-size:12px; color:rgba(255,255,255,.75); margin-top:2px; }

    /* CONTAINER */
    .container{
      width:100%;
      height:100%;
      display:flex;
      padding:20px;
      gap:20px;
    }

    /* ZONE JEU */
    .game-zone{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:30px;
      padding-top:70px;
    }

    /* QUESTION */
    .question-section{
      height:30%;
      background:linear-gradient(to bottom, #012A6D, #005BBB);
      border-radius:20px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:30px;
      border:3px solid rgba(255,255,255,0.3);
      box-shadow:0 10px 30px rgba(0,0,0,0.5);
      position:relative;
    }
    .question{
      font-size:40px;
      font-weight:800;
      text-align:center;
      text-shadow:2px 2px 4px rgba(0,0,0,0.5);
      max-width:90%;
    }

    /* CHRONO */
    .timer-container{
      position:absolute;
      top:20px;
      right:30px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
    }
    .timer-label{
      font-size:18px;
      color:#FF3333;
      font-weight:800;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    .timer{
      width:100px;
      height:100px;
      border-radius:50%;
      background:rgba(0,0,0,0.3);
      border:5px solid #FF3333;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:36px;
      font-weight:900;
      color:#FF3333;
      box-shadow:0 0 20px rgba(255,51,51,0.5);
    }
    .timer.warning{ animation:pulse 1s infinite; }
    .timer.danger{ animation:pulse 0.5s infinite; color:#CC0000; border-color:#CC0000; }

    /* RÃ‰PONSES */
    .answers-section{
      flex:1;
      display:flex;
      gap:30px;
      position:relative;
    }
    .answers-column{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:30px;
    }
    .answer-btn{
      flex:1;
      background:#F8D54B;
      border:none;
      border-radius:15px;
      font-size:32px;
      font-weight:900;
      color:#012A6D;
      cursor:pointer;
      transition:all .25s;
      box-shadow:0 8px 20px rgba(0,0,0,0.3);
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
    }
    .answer-btn:hover{
      background:#F2A900;
      transform:translateY(-5px);
      box-shadow:0 12px 25px rgba(0,0,0,0.4);
    }
    .answer-btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

    /* PASSER */
    .pass-container{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      z-index:10;
    }
    .pass-btn{
      width:180px;
      height:180px;
      border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #6c757d, #495057);
      border:none;
      color:#fff;
      font-size:22px;
      font-weight:900;
      cursor:pointer;
      box-shadow:0 0 0 15px #001A4D, 0 0 40px rgba(108,117,125,0.7);
      transition:all .25s;
      display:flex;
      align-items:center;
      justify-content:center;
      text-transform:uppercase;
      letter-spacing:1px;
      user-select:none;
    }
    .pass-btn:hover{
      background:radial-gradient(circle at 30% 30%, #5a6268, #343a40);
      
    }
    .pass-btn:disabled{ opacity:.5; cursor:not-allowed; }

    /* 4 Ã€ LA SUITE */
    .streak-zone{
      width:200px;
      background:#001A4D;
      border-radius:20px;
      padding:30px 20px;
      display:flex;
      flex-direction:column;
      align-items:center;
      border:3px solid rgba(255,255,255,0.2);
    }
    .streak-title{
      font-size:28px;
      color:#F8D54B;
      font-weight:900;
      text-align:center;
      margin-bottom:30px;
    }
    .streak-boxes{
      display:flex;
      flex-direction:column;
      gap:20px;
      width:100%;
    }
    .streak-box{
      width:100%;
      height:80px;
      background:rgba(255,255,255,0.1);
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:36px;
      font-weight:900;
      color:rgba(255,255,255,0.3);
      border:3px solid rgba(255,255,255,0.2);
      transition:all .25s;
    }
    .streak-box.filled{
      background:#F2A900;
      color:#012A6D;
      border-color:#F8D54B;
      box-shadow:0 0 20px rgba(242,169,0,0.5);
    }
    .streak-box.current{
      background:#33cc33;
      color:#fff;
      border-color:#33cc33;
      box-shadow:0 0 20px rgba(51,204,51,0.5);
    }
    .streak-counter{
      margin-top:auto;
      text-align:center;
      padding-top:30px;
    }
    .counter-number{
      font-size:42px;
      color:#F8D54B;
      font-weight:900;
    }
    .counter-label{
      font-size:18px;
      color:rgba(255,255,255,0.7);
      margin-top:10px;
    }

    @keyframes pulse{
      0%{ transform:scale(1); }
      50%{ transform:scale(1.05); }
      100%{ transform:scale(1); }
    }
  </style>
</head>

<body>
  <div class="stars" id="stars"></div>

  <div class="hud">
    <img id="humanAvatar" src="" alt="Avatar joueur">
    <div>
      <div class="name" id="humanName">Joueur 1</div>
      <div class="sub">Ã‰preuve â€” 4 Ã  la suite</div>
    </div>
  </div>

  <div class="container">
    <div class="game-zone">
      <div class="question-section">
        <div class="question" id="questionText">Chargementâ€¦</div>
        <div class="timer-container">
          <div class="timer-label">Chrono</div>
          <div class="timer" id="timer">45</div>
        </div>
      </div>

      <div class="answers-section">
        <div class="answers-column">
          <button class="answer-btn" id="a0">A</button>
          <button class="answer-btn" id="a1">B</button>
        </div>

        <div class="answers-column">
          <button class="answer-btn" id="a2">C</button>
          <button class="answer-btn" id="a3">D</button>
        </div>

        <div class="pass-container">
          <button class="pass-btn" id="passBtn">PASSER</button>
        </div>
      </div>
    </div>

    <div class="streak-zone">
      <div class="streak-title">4 Ã€ LA SUITE</div>

      <div class="streak-boxes">
        <div class="streak-box">4</div>
        <div class="streak-box">3</div>
        <div class="streak-box">2</div>
        <div class="streak-box">1</div>
      </div>

      <div class="streak-counter">
        <div class="counter-number" id="counterNumber">0/4</div>
        <div class="counter-label">Bonnes rÃ©ponses</div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      // =========================
      // CONFIG
      // =========================
      const TOTAL_TIME = 45;                 // chrono GLOBAL (ne se reset jamais entre questions)
      const STREAK_TARGET = 4;               // 4 Ã  la suite
      const NEXT_PAGE_URL = "epreuve3.html"; // adapte ton chemin

      // =========================
      // DOM
      // =========================
      const $ = (s) => document.querySelector(s);
      const dom = {
        stars: $("#stars"),

        humanName: $("#humanName"),
        humanAvatar: $("#humanAvatar"),

        questionText: $("#questionText"),
        timer: $("#timer"),
        passBtn: $("#passBtn"),
        answers: [$("#a0"), $("#a1"), $("#a2"), $("#a3")],

        streakBoxes: Array.from(document.querySelectorAll(".streak-box")),
        counterNumber: $("#counterNumber"),
      };

      // =========================
      // PROFIL (depuis Player.html)
      // =========================
      function getHumanPlayer() {
        const raw = localStorage.getItem("qpc_player");
        if (!raw) return { name: "Joueur 1", avatar: "" };
        try { return JSON.parse(raw); }
        catch { return { name: "Joueur 1", avatar: "" }; }
      }

      const human = getHumanPlayer();
      if (dom.humanName) dom.humanName.textContent = human.name || "Joueur 1";
      if (dom.humanAvatar && human.avatar) dom.humanAvatar.src = human.avatar;

      // =========================
      // Ã‰TOILES
      // =========================
      function buildStars(count = 140) {
        if (!dom.stars) return;
        dom.stars.innerHTML = "";
        for (let i = 0; i < count; i++) {
          const star = document.createElement("div");
          star.className = "star";
          star.style.left = (Math.random() * 100) + "%";
          star.style.top = (Math.random() * 100) + "%";
          const size = 1 + Math.random() * 2.2;
          star.style.width = size + "px";
          star.style.height = size + "px";
          star.style.animationDelay = (Math.random() * 3) + "s";
          star.style.animationDuration = (2 + Math.random() * 3) + "s";
          dom.stars.appendChild(star);
        }
      }

      // =========================
      // QUESTIONS (exemple)
      // =========================
      const questions = [
        { question: "Quelle est la capitale de la France ?", correct: "Paris", answers: ["Paris", "Bruxelles", "GenÃ¨ve", "Dakar"] },
        { question: "Quelle est la capitale de l'Italie ?", correct: "Rome", answers: ["Rome", "Milan", "Naples", "Turin"] },
        { question: "Quelle est la capitale de l'Espagne ?", correct: "Madrid", answers: ["Madrid", "Barcelone", "SÃ©ville", "Valence"] },
        { question: "Quelle est la capitale de l'Allemagne ?", correct: "Berlin", answers: ["Berlin", "Munich", "Hambourg", "Francfort"] },
        { question: "Quelle est la capitale du Royaume-Uni ?", correct: "Londres", answers: ["Londres", "Manchester", "Liverpool", "Ã‰dimbourg"] },
        { question: "Quelle est la capitale du Portugal ?", correct: "Lisbonne", answers: ["Lisbonne", "Porto", "Coimbra", "Faro"] },
        { question: "Quelle est la capitale de la Belgique ?", correct: "Bruxelles", answers: ["Bruxelles", "Anvers", "Gand", "LiÃ¨ge"] },
      ];

      // =========================
      // STATE
      // =========================
      const state = {
        gameActive: false,
        timeLeft: TOTAL_TIME,     // chrono GLOBAL
        timerId: null,

        currentQuestion: 0,
        currentStreak: 0,
        locked: false,            // Ã©vite double clic
      };

      // =========================
      // HELPERS UI
      // =========================
      function setTimerUI() {
        if (!dom.timer) return;
        dom.timer.textContent = String(state.timeLeft);

        dom.timer.classList.remove("warning", "danger");
        if (state.timeLeft <= 10) dom.timer.classList.add("danger");
        else if (state.timeLeft <= 20) dom.timer.classList.add("warning");
      }

      function lockAnswers(locked) {
        state.locked = locked;
        dom.answers.forEach(btn => { if (btn) btn.disabled = locked || !state.gameActive; });
        if (dom.passBtn) dom.passBtn.disabled = locked || !state.gameActive;
      }

      function resetAnswerColors() {
        dom.answers.forEach(btn => {
          if (!btn) return;
          btn.style.background = "#F8D54B";
          btn.style.color = "#012A6D";
          btn.style.opacity = "1";
        });
      }

      function updateStreakUI() {
        // Boxes ont le texte 4/3/2/1
        dom.streakBoxes.forEach(b => b.classList.remove("filled", "current"));

        // Remplit celles <= currentStreak
        dom.streakBoxes.forEach((box) => {
          const n = Number(box.textContent.trim()); // 4,3,2,1
          if (state.currentStreak >= n) box.classList.add("filled");
        });

        // prochaine Ã  obtenir
        if (state.currentStreak < STREAK_TARGET) {
          const nextToGet = state.currentStreak + 1;
          const currentBox = dom.streakBoxes.find(b => Number(b.textContent.trim()) === nextToGet);
          if (currentBox) {
            currentBox.classList.remove("filled");
            currentBox.classList.add("current");
          }
        }

        if (dom.counterNumber) dom.counterNumber.textContent = `${state.currentStreak}/${STREAK_TARGET}`;
      }

      function renderQuestion() {
        const q = questions[state.currentQuestion];
        if (!q) return;

        if (dom.questionText) dom.questionText.textContent = q.question;

        dom.answers.forEach((btn, i) => {
          if (!btn) return;
          btn.textContent = q.answers[i] ?? `RÃ©ponse ${i + 1}`;
          btn.dataset.answer = q.answers[i] ?? "";
        });

        resetAnswerColors();
      }

      // =========================
      // TIMER GLOBAL (NE SE RESET PAS)
      // =========================
      function stopGlobalTimer() {
        if (state.timerId) clearInterval(state.timerId);
        state.timerId = null;
      }

      function startGlobalTimer() {
        if (state.timerId) return; // dÃ©jÃ  lancÃ©

        setTimerUI();

        state.timerId = setInterval(() => {
          if (!state.gameActive) return;

          state.timeLeft -= 1;
          setTimerUI();

          if (state.timeLeft <= 0) {
            stopGlobalTimer();
            finishEpreuve("â° Temps Ã©coulÃ©. Passage Ã  lâ€™Ã©preuve suivante.");
          }
        }, 1000);
      }

      // =========================
      // FIN Ã‰PREUVE
      // =========================
      function finishEpreuve(message) {
        state.gameActive = false;
        lockAnswers(true);
        stopGlobalTimer();

        setTimeout(() => {
          alert(message);
          window.location.href = NEXT_PAGE_URL;
        }, 250);
      }

      // =========================
      // GAME FLOW
      // =========================
      function nextQuestion() {
        state.currentQuestion = (state.currentQuestion + 1) % questions.length;
        renderQuestion();
        lockAnswers(false);
      }

      function onPass() {
        if (!state.gameActive || state.locked) return;

        // passer casse la sÃ©rie
        state.currentStreak = 0;
        updateStreakUI();

        lockAnswers(true);
        setTimeout(() => nextQuestion(), 250);
      }

      function onAnswerClick(index) {
        if (!state.gameActive || state.locked) return;

        const q = questions[state.currentQuestion];
        const chosen = dom.answers[index]?.dataset.answer ?? "";
        const correct = q.correct;

        lockAnswers(true);

        if (chosen === correct) {
          // bonne
          const btn = dom.answers[index];
          if (btn) { btn.style.background = "#33cc33"; btn.style.color = "#fff"; }
          state.currentStreak += 1;
          updateStreakUI();

          if (state.currentStreak >= STREAK_TARGET) {
            finishEpreuve(`ðŸŽ‰ ${human.name || "Joueur 1"} : ${STREAK_TARGET} Ã  la suite ! Passage Ã  lâ€™Ã©preuve suivante.`);
            return;
          }

          setTimeout(() => nextQuestion(), 650);
        } else {
          // mauvaise
          const btn = dom.answers[index];
          if (btn) { btn.style.background = "#cc0000"; btn.style.color = "#fff"; }

          // montrer la bonne
          dom.answers.forEach(b => {
            if (!b) return;
            if (b.dataset.answer === correct) {
              b.style.background = "#33cc33";
              b.style.color = "#fff";
            }
          });

          setTimeout(() => {
            state.currentStreak = 0;
            updateStreakUI();
            nextQuestion();
          }, 900);
        }
      }

      // =========================
      // EVENTS
      // =========================
      function bind() {
        if (dom.passBtn) dom.passBtn.addEventListener("click", onPass);
        dom.answers.forEach((btn, i) => {
          if (!btn) return;
          btn.addEventListener("click", () => onAnswerClick(i));
        });
      }

      // =========================
      // START
      // =========================
      function start() {
        buildStars();
        bind();

        state.gameActive = true;
        state.timeLeft = TOTAL_TIME; // reset seulement AU DÃ‰BUT de lâ€™Ã©preuve, pas entre questions

        state.currentStreak = 0;
        state.currentQuestion = 0;
        updateStreakUI();

        renderQuestion();
        lockAnswers(false);

        startGlobalTimer(); // chrono continu
      }

      start();
    })();
  </script>
</body>
</html>
